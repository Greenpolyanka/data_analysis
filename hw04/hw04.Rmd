---
title: "Лаб4"
author: "Каменева П.Д."
date: "2024-11-01"
output:
  pdf_document: default
  word_document: default
---

##Дисперсионный анализ. Лабораторная 4

#Загрузим данные

```{r}
data = read.csv("C:/Users/AT2/Downloads/lecture 5.1/data/diet.csv",row.names=1)
summary(data)#Показывает  краткую  статистическую  информацию  о  данных  (среднее,  медиана,  минимум,  максимум,  квартили).
```
#Ознакомимся со структурой и переименуем колонки, как нам удобно
#files/Diet_data_description.docx

```{r}
colnames(data) <- c("gender", "age", "height", "initial.weight", "diet.type", "final.weight")#Переименовывает  колонки  для  удобства  работы.
data$diet.type <- factor(c("A", "B", "C")[data$diet.type])#Преобразует  колонку  diet.type  в  фактор  (категориальную  переменную),  присваивая  каждой  группе  диеты  уникальный  уровень.
```

#Добавим новую колонку

```{r}
data$weight.loss = data$initial.weight - data$final.weight#Создает  новую  колонку  weight.loss,  содержащую  разницу  между  начальным  и  конечным  весом.
```

#Проанализиуем есть ли различия по типам диет

```{r}
boxplot(weight.loss~diet.type,data=data,col="light gray",
        ylab = "Weight loss (kg)", xlab = "Diet type")
abline(h=0,col="green")
```

#проверим сбалансированные ли данные (равное ли количество наблюдений в каждой группе диеты)

```{r}
table(data$diet.type)
```
Количество наблюдений в группах разное, это может повлиять на результаты ANOVA, и необходимо применять специальные методы для учета несбалансированности данных.

#График групповых средних

```{r}
install.packages("gplots")
```

```{r}
library(gplots) #библиотека устанавлевается с помощью install.packages
plotmeans(weight.loss ~ diet.type, data=data)
aggregate(data$weight.loss, by = list(data$diet.type), FUN=sd)
```
 x - Стандартное отклонение потери веса для каждой группы диеты.

#Для подгонки ANOVA модели используем функцию aov, частный случай линейной модели lm
#тест на межгрупповые различия

```{r}
fit <- aov(weight.loss ~ diet.type, data=data)
summary(fit)
```
* Df: Степени свободы (degrees of freedom). diet.type имеет 2 степени свободы, потому что у нас 3 группы диеты. Residuals (остатки) имеют 75 степеней свободы (количество наблюдений минус количество групп).
• Sum Sq: Сумма квадратов (sum of squares). Это мера изменчивости данных внутри каждой группы и между группами. 
• Mean Sq: Средняя квадратическая сумма (mean square). Получается делением Sum Sq на Df.
• F value: F-статистика. Это отношение Mean Sq между группами к Mean Sq внутри групп. 
• Pr(>F): P-значение. Это вероятность получить такие же или более экстремальные результаты, если нет различий между группами.
• Pr(>F) = 0.00323: Это p-значение для теста ANOVA. Оно меньше 0.05, что указывает на статистически значимые различия между группами диеты (то есть мы отвергаем нулевую гипотезу о том, что нет различий).
• F value = 6.197: F-статистика высока, что подтверждает наличие значимых различий.

#попарные различия между средними значениями для всех групп

```{r}
TukeyHSD(fit)
```

Результаты теста TukeyHSD показывают попарные различия между средними значениями потери веса для всех групп диеты (A, B, C).

Интерпретация результатов:

• B-A -0.2740741 -1.8806155 1.332467 0.9124737: Доверительный интервал для разницы между диеты B и A включает 0. Это означает, что нет статистически значимой разницы между диеты B и A.
• C-A 1.8481481 0.2416067 3.454690 0.0201413: Доверительный интервал не включает 0. Это означает, что существует статистически значимая разница между диеты C и A (p-значение меньше 0.05). Средняя потеря веса для диеты C значительно выше, чем для диеты A.
• C-B 2.1222222 0.5636481 3.680796 0.0047819: Доверительный интервал не включает 0. Это означает, что существует статистически значимая разница между диеты C и B (p-значение меньше 0.05). Средняя потеря веса для диеты C значительно выше, чем для диеты B.

Вывод:

• Диета C приводит к значительно большей потере веса, чем диеты A и B.
• Между диеты A и B нет значимых различий в потере веса.

#Tukey honest significant differences test)
```{r}
install.packages("multcomp")
```

```{r}
library(multcomp)
par(mar=c(5,4,6,2))
tuk <- glht(fit, linfct=mcp(diet.type="Tukey"))
plot(cld(tuk, level=.05),col="pink")
```

#Добавить проверку на выбросы и избавиться от них
```{r}
boxplot(weight.loss ~ diet.type, data=data, col="light gray",
        ylab = "Weight loss (kg)", xlab = "Diet type")
abline(h=0,col="green")

# Проверка на выбросы с помощью boxplot.stats()
outliers <- boxplot.stats(data$weight.loss)$out

# Вывод найденных выбросов
print(outliers) 
```
Не было найдено выбросов
#повторно проверсти все тесты и сравнить результаты с выбросами и без

##1.Выполнить парный t-test . Игнорируя тип диеты, проверить, есть ли потеря веса.

Парный  t-тест  используется  для  сравнения  средних  значений  двух  групп  данных,  когда  эти  группы  спаренные  (например,  измерения  "до"  и  "после"  для  одних  и  тех  же  участников).
•  В  данном  случае,  мы  сравниваем  начальный  вес  initial.weight  с  конечным  весом  final.weight  для  одних  и  тех  же  участников.
•  Важно  указать  paired = TRUE  в  функции  t.test,  чтобы  указать,  что  данные  спаренные.
```{r}
# Загружаем пакет для t-теста
library(stats)

# Проводим парный t-тест
t_test_result <- t.test(data$initial.weight, data$final.weight, paired = TRUE)

# Выводим результаты t-теста
print(t_test_result)

```
• t = 13.309:  Статистика  t-теста  (t-value).  Она  отражает  размер  различия  между  группами. 
• df = 77:  Степени  свободы  (degrees  of  freedom).  Они  определяются  как  количество  наблюдений  минус  1.
• p-value < 2.2e-16:  P-значение.  Вероятность  получить  такие  же  или  более  экстремальные  результаты,  если  нет  различий  между  группами.  В  этом  случае  p-значение  очень  мало  (практически  равно  0),  что  указывает  на  очень  сильную  статистическую  значимость  различий.
• alternative hypothesis: true mean difference is not equal to 0:  Альтернативная  гипотеза.  Она  утверждает,  что  истинное  среднее  значение  разницы  не  равно  0. 
• 95 percent confidence interval: 3.269602 4.420141:  Доверительный  интервал  для  среднего  значения  разницы.  Он  показывает  диапазон  значений,  в  которых  с  вероятностью  95%  находится  истинное  среднее  значение  разницы.  
• mean difference = 3.844872:  Среднее  значение  разницы  между  начальным  и  конечным  весом.  Это  означает,  что  в  среднем  участники  потеряли  3.84  кг  веса.

Вывод:

•  Парный  t-тест  подтвердил,  что  существует  значимая  потеря  веса  (p-значение  очень  мало),  в  среднем  участники  потеряли  около  3.84  кг  веса.

##3. Описательная статистика
Описать статистические характеристики (среднее, стандартное отклонение, медиана) для каждой диеты
```{r}
install.packages("dplyr")
```

```{r}
# Загружаем пакет dplyr для удобной работы с данными
library(dplyr)

# Группируем данные по типу диеты
summary_stats <- data %>%
  group_by(diet.type) %>%
  summarise(
    Среднее = mean(weight.loss),
    Стандартное_отклонение = sd(weight.loss),
    Медиана = median(weight.loss)
  )

# Выводим результаты
print(summary_stats)
```
• Среднее: Показывает среднюю потерю веса для каждой группы диеты.
• Стандартное_отклонение: Показывает, насколько изменчивы данные потери веса внутри каждой группы. 
• Медиана: Показывает среднее значение потери веса для каждой группы диеты, учитывая распределение данных.

##4.Однофакторный ANOVA. Какая диета лучше всего помогает сбросить вес? Есть ли различия в потере веса в зависимости от пола?
```{r}
# Загружаем пакет для ANOVA
library(stats)

# Однофакторный ANOVA по типу диеты
fit_diet <- aov(weight.loss ~ diet.type, data = data)
summary(fit_diet)

# Однофакторный ANOVA по полу
fit_gender <- aov(weight.loss ~ gender, data = data)
summary(fit_gender)

```
• Df: 2 (степени свободы для типа диеты).
• Sum Sq: 71,1 (сумма квадратов для типа диеты).
• Mean Sq: 35,55 (средняя квадратическая сумма для типа диеты).
• F value: 6,197 (F-статистика для типа диеты).
• Pr(>F): 0,00323 (p-значение для типа диеты).

Вывод:

P-значение (0,00323) меньше 0,05, что означает, что мы отвергаем нулевую гипотезу о том, что нет различий в потере веса между группами диеты. То есть, тип диеты влияет на потерю веса.

Вывод для ANOVA по полу (fit_gender):

• Df: 1 (степени свободы для пола).
• Sum Sq: 0,3 (сумма квадратов для пола).
• Mean Sq: 0,278 (средняя квадратическая сумма для пола).
• F value: 0,044 (F-статистика для пола).
• Pr(>F): 0,835 (p-значение для пола).

Вывод:

P-значение (0,835) больше 0,05, что означает, что мы не можем отвергнуть нулевую гипотезу о том, что нет различий в потере веса между группами пола. То есть, пол не влияет на потерю веса.

##5.Двухфакторный ANOVA. Влияние диеты и пола на потерю веса

```{r}
# Загружаем пакет для ANOVA
library(stats)

# Двухфакторный ANOVA
fit_interaction <- aov(weight.loss ~ diet.type * gender, data = data)
summary(fit_interaction)

```
Результаты двухфакторного ANOVA указывают на то, что:

1. Тип диеты (diet.type) оказывает значимое влияние на потерю веса (p-значение = 0,00541). 

2. Пол (gender) не оказывает значимого влияния на потерю веса (p-значение = 0,85991). 

3. Существует значимое взаимодействие между типом диеты и полом (diet.type:gender, p-значение = 0,04884). Это означает, что влияние типа диеты на потерю веса зависит от пола.

##6.Взаимодействие. Построить график средних значений потери веса в зависимости от типа диеты и пола.
```{r}
install.packages("ggplot2")
```
```{r}
install.packages("Hmisc")
```

```{r}
# Загружаем пакет для построения графиков
library(ggplot2)

# Создаем график взаимодействия
interaction_plot <- ggplot(data, aes(x = diet.type, y = weight.loss, color = factor(gender))) +
  stat_summary(fun = mean, geom = "point", size = 3) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  labs(x = "Тип диеты", y = "Потеря веса (кг)", color = "Пол") +
  ggtitle("Взаимодействие типа диеты и пола на потерю веса") +
  theme_bw()

# Выводим график
print(interaction_plot)
```

```

